name: âš¡ Quick Tests
run-name: ${{ github.actor }} running quick tests âš¡

on:
  pull_request:
    types: [opened, synchronize, reopened]
  
  # Allow manual triggers for quick testing
  workflow_dispatch:

jobs:
  quick-test:
    name: âš¡ Quick Test Suite
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ðŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: ðŸ“¦ Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: ðŸ§ª Quick import test
      run: |
        python -c "
        print('ðŸ” Testing core imports...')
        import pandas as pd
        import streamlit as st
        import yfinance as yf
        import plotly.express as px
        print('âœ… Core dependencies working')
        
        print('ðŸ” Testing app modules...')
        import app
        import financial_apis
        print('âœ… App modules import successfully')
        
        print('ðŸ” Testing SoFi CSV cleaner...')
        from data.sofi_cleaner import clean_sofi_investment_csv
        print('âœ… SoFi cleaner import working')
        
        print('ðŸŽ‰ All quick tests passed!')
        "
        
    - name: ðŸ“Š Validate sample data
      run: |
        python -c "
        import pandas as pd
        
        print('ðŸ“Š Testing sample portfolio...')
        df = pd.read_csv('sample_portfolio.csv')
        assert len(df) > 0, 'Sample portfolio is empty'
        assert 'Symbol' in df.columns, 'Missing Symbol column'
        assert 'Shares' in df.columns, 'Missing Shares column'
        print(f'âœ… Sample portfolio valid: {len(df)} positions')
        "
        
    - name: ðŸ§¹ Test SoFi cleaner
      run: |
        python data/sofi_cleaner.py sample_portfolio.csv --output quick_test_output.csv
        if [ -f "quick_test_output.csv" ]; then
          echo "âœ… SoFi CSV cleaner working"
          rm quick_test_output.csv
        else
          echo "âŒ SoFi CSV cleaner failed"
          exit 1
        fi
        
    - name: ðŸŽ‰ Quick test summary
      run: |
        echo "## âš¡ Quick Test Results" >> $GITHUB_STEP_SUMMARY
        echo "âœ… **All core tests passed!**" >> $GITHUB_STEP_SUMMARY
        echo "- Dependencies: âœ… Working" >> $GITHUB_STEP_SUMMARY
        echo "- App imports: âœ… Working" >> $GITHUB_STEP_SUMMARY
        echo "- Sample data: âœ… Valid" >> $GITHUB_STEP_SUMMARY
        echo "- SoFi cleaner: âœ… Working" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "ðŸš€ Ready for full CI/CD pipeline!" >> $GITHUB_STEP_SUMMARY 